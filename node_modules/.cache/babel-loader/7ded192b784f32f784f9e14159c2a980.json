{"ast":null,"code":"import t, { Fragment as n, createElement as r, Children as i, PureComponent as u } from \"react\";\n\nfunction o(t, n) {\n  for (var r = 0; r < n.length; r++) {\n    var i = n[r];\n    i.enumerable = i.enumerable || !1, i.configurable = !0, \"value\" in i && (i.writable = !0), Object.defineProperty(t, i.key, i);\n  }\n}\n\nfunction e() {\n  return (e = Object.assign || function (t) {\n    for (var n = 1; n < arguments.length; n++) {\n      var r = arguments[n];\n\n      for (var i in r) Object.prototype.hasOwnProperty.call(r, i) && (t[i] = r[i]);\n    }\n\n    return t;\n  }).apply(this, arguments);\n}\n\nfunction c(t, n) {\n  t.prototype = Object.create(n.prototype), t.prototype.constructor = t, t.__proto__ = n;\n}\n\nvar f = function () {},\n    s = n ? function (t) {\n  return t ? t.length > 1 ? r.apply(void 0, [n, null].concat(t)) : i.only(t) : null;\n} : i.only,\n    a = function (t) {\n  function n() {\n    for (var n, r = arguments.length, i = new Array(r), u = 0; u < r; u++) i[u] = arguments[u];\n\n    return (n = t.call.apply(t, [this].concat(i)) || this).t = !1, n.i = null, n.u = f, n;\n  }\n\n  c(n, t);\n  var r,\n      i,\n      u,\n      e = n.prototype;\n  return e.componentWillUnmount = function () {\n    this.u();\n  }, e.o = function (t) {\n    var n = this;\n    t !== this.i && (this.u(), this.i = null, t && (this.i = t, this.u = t.on(\"updated\", function () {\n      return n.forceUpdate();\n    })));\n  }, e.s = function () {\n    var t = this.props,\n        n = t.of || t.a || t.an || t.this || t.on,\n        r = t.not ? \"cannot\" : \"can\";\n    return t.ability[r](t.I || t.do, n, t.field);\n  }, e.render = function () {\n    return this.o(this.props.ability), this.t = this.s(), this.props.passThrough || this.t ? this.h() : null;\n  }, e.h = function () {\n    var t = this.props,\n        n = t.children,\n        r = t.ability,\n        i = \"function\" == typeof n ? n(this.t, r) : n;\n    return s(i);\n  }, r = n, (i = [{\n    key: \"allowed\",\n    get: function () {\n      return this.t;\n    }\n  }]) && o(r.prototype, i), u && o(r, u), n;\n}(u);\n\nfunction h(t) {\n  var n, r;\n  return r = n = function (t) {\n    function n() {\n      return t.apply(this, arguments) || this;\n    }\n\n    return c(n, t), n;\n  }(a), n.defaultProps = {\n    ability: t\n  }, r;\n}\n\nfunction l(t) {\n  return function (n) {\n    return r(t, null, function (t) {\n      return r(a, e({\n        ability: t\n      }, n));\n    });\n  };\n}\n\nfunction v(n) {\n  if (\"production\" !== process.env.NODE_ENV && \"function\" != typeof t.useContext) throw new Error(\"You must use React >= 16.8 in order to use useAbility()\");\n  var r = t.useContext(n),\n      i = t.useState(),\n      u = i[0],\n      o = i[1];\n  return t.useEffect(function () {\n    return r.on(\"updated\", function (t) {\n      t.rules !== u && o(t.rules);\n    });\n  }, []), r;\n}\n\nexport { a as Can, h as createCanBoundTo, l as createContextualCan, v as useAbility };","map":{"version":3,"sources":["../../src/Can.ts","../../src/factory.ts","../../src/hooks/useAbility.ts"],"names":["noop","renderChildren","Fragment","children","length","createElement","Children","only","Can","PureComponent","_isAllowed","_ability","_unsubscribeFromAbility","componentWillUnmount","_connectToAbility","ability","this","on","_this2","forceUpdate","_canRender","props","subject","of","a","an","can","not","I","do","field","render","passThrough","_renderChildren","elements","createCanBoundTo","defaultProps","createContextualCan","Getter","h","useAbility","context","process","env","NODE_ENV","React","useContext","Error","rules","setRules","useState","useEffect","event"],"mappings":"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","sourcesContent":["import { Children, ReactNodeArray, PureComponent, Fragment, createElement } from 'react';\nimport {\n  Unsubscribe,\n  AbilityTuple,\n  SubjectType,\n  AnyAbility,\n  Generics,\n  Abilities,\n  IfString,\n} from '@casl/ability';\n\nconst noop = () => {};\nconst renderChildren = Fragment\n  ? (children?: ReactNodeArray) => {\n    if (!children) {\n      return null;\n    }\n\n    return children.length > 1\n      ? createElement(Fragment, null, ...children)\n      : Children.only(children);\n  }\n  : Children.only;\n\ntype AbilityCanProps<\n  T extends Abilities,\n  Else = IfString<T, { do: T } | { I: T }>\n> = T extends AbilityTuple\n  ? { do: T[0], on: T[1], field?: string } |\n  { I: T[0], a: Extract<T[1], SubjectType>, field?: string } |\n  { I: T[0], an: Extract<T[1], SubjectType>, field?: string } |\n  { I: T[0], this: Exclude<T[1], SubjectType>, field?: string }\n  : Else;\n\ninterface ExtraProps {\n  not?: boolean\n  passThrough?: boolean\n}\n\ninterface CanExtraProps<T extends AnyAbility> extends ExtraProps {\n  ability: T\n}\n\ninterface BoundCanExtraProps<T extends AnyAbility> extends ExtraProps {\n  ability?: T\n}\n\nexport type CanProps<T extends AnyAbility> =\n  AbilityCanProps<Generics<T>['abilities']> & CanExtraProps<T>;\nexport type BoundCanProps<T extends AnyAbility> =\n  AbilityCanProps<Generics<T>['abilities']> & BoundCanExtraProps<T>;\n\nexport class Can<\n  T extends AnyAbility,\n  IsBound extends boolean = false\n> extends PureComponent<IsBound extends true ? BoundCanProps<T> : CanProps<T>> {\n  private _isAllowed: boolean = false;\n  private _ability: T | null = null;\n  private _unsubscribeFromAbility: Unsubscribe = noop;\n\n  componentWillUnmount() {\n    this._unsubscribeFromAbility();\n  }\n\n  private _connectToAbility(ability?: T) {\n    if (ability === this._ability) {\n      return;\n    }\n\n    this._unsubscribeFromAbility();\n    this._ability = null;\n\n    if (ability) {\n      this._ability = ability;\n      this._unsubscribeFromAbility = ability.on('updated', () => this.forceUpdate());\n    }\n  }\n\n  get allowed() {\n    return this._isAllowed;\n  }\n\n  private _canRender(): boolean {\n    const props: any = this.props;\n    const subject = props.of || props.a || props.an || props.this || props.on;\n    const can = props.not ? 'cannot' : 'can';\n\n    return props.ability[can](props.I || props.do, subject, props.field);\n  }\n\n  render() {\n    this._connectToAbility(this.props.ability);\n    this._isAllowed = this._canRender();\n    return this.props.passThrough || this._isAllowed ? this._renderChildren() : null;\n  }\n\n  private _renderChildren() {\n    const { children, ability } = this.props;\n    const elements = typeof children === 'function'\n      ? children(this._isAllowed, ability)\n      : children;\n\n    return renderChildren(elements);\n  }\n}\n","import { createElement as h, ComponentClass, Consumer, StatelessComponent } from 'react';\nimport { AnyAbility } from '@casl/ability';\nimport { Can, BoundCanProps } from './Can';\n\ninterface BoundCanClass<T extends AnyAbility> extends ComponentClass<BoundCanProps<T>> {\n  new (props: BoundCanProps<T>, context?: any): Can<T, true>\n}\n\nexport function createCanBoundTo<T extends AnyAbility>(ability: T): BoundCanClass<T> {\n  return class extends Can<T, true> {\n    static defaultProps = { ability } as BoundCanClass<T>['defaultProps'];\n  };\n}\n\nexport function createContextualCan<T extends AnyAbility>(\n  Getter: Consumer<T>\n): StatelessComponent<BoundCanProps<T>> {\n  return (props: BoundCanProps<T>) => h(Getter, null, (ability: T) => h(Can, {\n    ability,\n    ...props,\n  } as any));\n}\n","import React from 'react';\nimport { AnyAbility } from '@casl/ability';\n\nexport function useAbility<T extends AnyAbility>(context: React.Context<T>): T {\n  if (process.env.NODE_ENV !== 'production' && typeof React.useContext !== 'function') {\n    throw new Error('You must use React >= 16.8 in order to use useAbility()');\n  }\n\n  const ability = React.useContext<T>(context);\n  const [rules, setRules] = React.useState<T['rules']>();\n\n  React.useEffect(() => ability.on('updated', (event) => {\n    if (event.rules !== rules) {\n      setRules(event.rules);\n    }\n  }), []);\n\n  return ability;\n}\n"]},"metadata":{},"sourceType":"module"}